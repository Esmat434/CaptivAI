<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friendly Social Registration</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a2e; /* پس‌زمینه آبی-بنفش بسیار تیره */
            color: #f0f0f0;
            /* overflow: hidden;  <-- مشکل اینجا بود! این خط حذف شد */
            /* به بدنه اجازه می‌دهیم در صورت نیاز اسکرول شود */
        }

        /* * انیمیشن خفن: حباب‌های متحرک (دوستانه)
         * این بوم در پس‌زمینه ثابت می‌ماند
        */
        #bubble-canvas {
            position: fixed; /* ثابت در پس‌زمینه */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* این کانتینر اصلی است که اجازه اسکرول دارد */
        .main-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* حداقل به اندازه ارتفاع صفحه */
            padding: 4rem 1rem; /* فاصله از بالا و پایین برای اسکرول بهتر */
        }

        /* کارت شیشه‌ای */
        .registration-card {
            background: rgba(255, 255, 255, 0.05); /* شیشه روشن‌تر */
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease-out;
            width: 100%; /* برای اینکه در ستون بوت‌استرپ جا شود */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* دکمه اصلی */
        .btn-submit-custom {
            background-color: #ffffff;
            color: #1a1a2e;
            font-weight: 600;
            border: none;
            transition: all 0.3s ease;
        }
        .btn-submit-custom:hover {
            background-color: #f0f0f0;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }
        /* ------------------------------------ */
        /* TOP ALERT CONTAINER STYLING */
        /* ------------------------------------ */
        .top-alert-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            z-index: 2000; 
        }
        
        /* Alert Styling for Dark Theme */
        .alert-dark-theme {
            background-color: rgba(30, 30, 50, 0.9); /* رنگ زمینه تیره شیک */
            color: #f0f0f0;
            border-left: 5px solid; /* خط رنگی در سمت چپ */
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
            animation: slideDownAndFade 0.5s ease-out forwards; /* انیمیشن ورود */
        }

        .alert-dark-theme.alert-success { border-color: #4CAF50; }
        .alert-dark-theme.alert-warning { border-color: #FFC107; }
        .alert-dark-theme.alert-danger { border-color: #F44336; }
        .alert-dark-theme.alert-info { border-color: #2196F3; }

        @keyframes slideDownAndFade {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="top-alert-container">
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-dismissible fade show alert-dark-theme alert-{{ message.tags }}" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i> {{ message }}
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}

        {% if form.errors %}
            <div class="alert alert-dismissible fade show alert-dark-theme alert-danger" role="alert">
                <h6 class="alert-heading text-light"><i class="fas fa-times-circle me-2"></i> **Error! Please correct the fields below:**</h6>
                <ul class="list-unstyled mb-0 ms-3">
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li class="small mt-1">
                                {% if field != '__all__' %}
                                    <strong class="text-white-75">{{ field|capfirst }}:</strong>
                                {% endif %}
                                {{ error }}
                            </li>
                        {% endfor %}
                    {% endfor %}
                </ul>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endif %}
    </div>
    <canvas id="bubble-canvas"></canvas>

    <main class="main-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-md-10 col-lg-8">
                    
                    <div class="registration-card p-4 p-md-5" data-bs-theme="dark">
                        
                        <h2 class="text-white text-center fw-bold fs-2 mb-3">Join Us</h2>
                        <p class="text-white-50 text-center mb-5">Create your account to connect</p>

                        <form action="{% url 'accounts:register' %}" method="POST" enctype="multipart/form-data">
                            {% csrf_token %}
                            <div class="row g-3">
                                
                                <div class="col-md-6">
                                    <label for="first_name" class="form-label text-white-50">First Name</label>
                                    {{ form.first_name }}
                                </div>

                                <div class="col-md-6">
                                    <label for="last_name" class="form-label text-white-50">Last Name</label>
                                    {{ form.last_name }}
                                </div>

                                <div class="col-12">
                                    <label for="username" class="form-label text-white-50">Username <span class="text-danger">*</span></label>
                                    {{ form.username }}
                                </div>

                                <div class="col-12">
                                    <label for="email" class="form-label text-white-50">Email Address <span class="text-danger">*</span></label>
                                    {{ form.email }}
                                </div>

                                <div class="col-md-6">
                                    <label for="birth_date" class="form-label text-white-50">Birth Date <span class="text-danger">*</span></label>
                                    {{ form.birth_date }}
                                </div>

                                <div class="col-md-6">
                                    <label for="avatar" class="form-label text-white-50">Avatar</label>
                                    {{ form.avatar }}
                                </div>

                                <div class="col-12">
                                    <label for="password" class="form-label text-white-50">Password <span class="text-danger">*</span></label>
                                    {{ form.password }}
                                </div>

                                <div class="col-12">
                                    <label for="confirm-password" class="form-label text-white-50">Confirm Password <span class="text-danger">*</span></label>
                                    {{ form.confirm_password }}
                                </div>

                                <div class="col-12 mt-5">
                                    <button type="submit" class="btn btn-submit-custom w-100 py-2 fs-5">
                                        Create Account
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 2. انیمیشن "خفن" حباب‌های متحرک
        const canvas = document.getElementById('bubble-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let bubbles = [];

        // کلاس برای تعریف هر حباب
        class Bubble {
            constructor(x, y, radius, dx, dy) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.dx = dx; // سرعت افقی
                this.dy = dy; // سرعت عمودی (حرکت به بالا)
                this.opacity = 1;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                // گرادیانت نرم برای حس بهتر (بدون رنگ تند)
                let gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius);
                gradient.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
                gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0.1)');
                gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
                
                ctx.fillStyle = gradient;
                ctx.fill();
            }

            update() {
                // حرکت به بالا
                this.y += this.dy;
                // حرکت افقی سینوسی (برای لرزش نرم)
                this.x += Math.sin(this.y / 50) * this.dx;

                // اگر حباب از صفحه خارج شد، آن را ریست کن
                if (this.y < -this.radius) {
                    this.y = canvas.height + this.radius;
                    this.x = Math.random() * canvas.width;
                    this.radius = Math.random() * 50 + 10; // 10 تا 60 پیکسل
                    this.dy = -(Math.random() * 0.5 + 0.1); // سرعت آهسته
                }
                
                this.draw();
            }
        }

        // ایجاد حباب‌های اولیه
        function init() {
            bubbles = [];
            let bubbleCount = (canvas.width * canvas.height) / 10000; // تعداد حباب‌ها بر اساس اندازه صفحه
            for (let i = 0; i < bubbleCount; i++) {
                let radius = Math.random() * 50 + 10;
                let x = Math.random() * canvas.width;
                let y = Math.random() * canvas.height + radius;
                let dy = -(Math.random() * 0.5 + 0.1); // سرعت آهسته به سمت بالا
                let dx = Math.random() - 0.5; // حرکت افقی تصادفی
                bubbles.push(new Bubble(x, y, radius, dx, dy));
            }
        }

        // لوپ انیمیشن
        function animate() {
            requestAnimationFrame(animate);
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let bubble of bubbles) {
                bubble.update();
            }
        }

        // تنظیم مجدد در صورت تغییر اندازه پنجره
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            init(); // بازسازی حباب‌ها برای اندازه جدید
        });

        init();
        animate();

    </script>
</body>
</html>